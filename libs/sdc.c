/*
 * sdc.c
 *
 *  Created on: 10 de dez de 2021
 *      Author: marco
 */

//===========================================================================
/*------------------------------- Includes --------------------------------*/
//===========================================================================
#include "sdc.h"

/* Drivers */
#include "spihl.h"
//===========================================================================

//typedef struct{
//
//}sdcControl_t;

//===========================================================================
/*------------------------------- Prototypes ------------------------------*/
//===========================================================================
//---------------------------------------------------------------------------
static int32_t sdcInitializeHW(void);
//---------------------------------------------------------------------------
static int32_t sdcInitializeSW(void);
//---------------------------------------------------------------------------
//===========================================================================

//===========================================================================
/*------------------------------- Functions -------------------------------*/
//===========================================================================
//---------------------------------------------------------------------------
int32_t sdcInitialize(void){

	if( sdcInitializeHW() != 0 ) return SDC_ERR_INIT_HW;

	if( sdcInitializeSW() != 0 ) return SDC_ERR_INIT_SW;


	return 0;
}
//---------------------------------------------------------------------------
//---------------------------------------------------------------------------
//===========================================================================

//===========================================================================
/*--------------------------- Static functions ----------------------------*/
//===========================================================================
//---------------------------------------------------------------------------
static int32_t sdcInitializeHW(void){

	spihlInitialize(SDC_CONFIG_SPI, SPIHL_BR_CLK_DIV_256, SPIHL_POLL_PHAF);

	return 0;
}
//---------------------------------------------------------------------------
static int32_t sdcInitializeSW(void){

	uint32_t k;
	uint8_t data;

	k = 100;
	data = 0xFF;
	while( k != 0 ){
		if( spihlWrite(SDC_CONFIG_SPI, &data, 1, 10000) != 0 ) break;
		k--;
	}
	if( k != 0 ) return SDC_ERR_INIT_SW;

	return 0;
}
//---------------------------------------------------------------------------
//===========================================================================
